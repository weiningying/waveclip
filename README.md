# WaveClip 🎵

一个简洁的音频剪辑 Web 应用，纯前端处理，无需上传文件到服务器。

![WaveClip Logo](wave.svg)

## 项目结构

```
/data/audio-editor/
├── index.html      # 主应用（单文件，含 HTML/CSS/JS）
├── wave.svg        # Logo 图标
├── start.sh        # 启动脚本
└── README.md       # 本文档
```

## 技术架构

### 核心技术栈
- **纯前端**：HTML5 + CSS3 + Vanilla JavaScript
- **音频处理**：Web Audio API
- **MP3 编码**：lamejs（客户端编码）
- **静态服务器**：Python http.server

### 关键 DOM 元素 ID
| ID | 说明 |
|----|------|
| `waveformContainer` | 波形图容器 |
| `waveform` | Canvas 波形画布 |
| `startSlider` / `endSlider` | 左右剪辑控制杆 |
| `trimArea` | 选中范围高亮区域 |
| `playhead` | 播放头红线 |
| `audioPlayer` | 原生 audio 元素 |
| `themeToggle` | 主题切换按钮 |

### 全局状态变量
```javascript
let audioBuffer = null;      // Web Audio API 音频缓冲区
let audioContext = null;     // 音频上下文
let duration = 0;            // 音频总时长
let startTime = 0;           // 剪辑开始时间
let endTime = 0;             // 剪辑结束时间
let playMode = 'selection';  // 'selection' | 'cursor'
let hasFileLoaded = false;   // 是否已加载文件
```

## 功能特性

### 🎼 音频处理
- **上传音频**：点击或拖拽上传（支持 MP3, WAV, AAC, FLAC 等格式）
- **可视化波形**：高清波形显示，支持窗口大小自适应
- **导出 MP3**：192kbps 比特率，本地编码下载

### ✂️ 多种剪辑方式
- **拖拽控制杆**：拖动左右两侧红色控制杆调整范围
- **鼠标框选**：在波形图上按住鼠标左键拖选范围
  - 仅左键有效
  - 右键或 ESC 取消框选
- **时间编辑**：点击"开始"或"结束"时间直接输入数值
- **快捷操作**：
  - 双击左侧控制杆 → 开始时间归零
  - 双击右侧控制杆 → 结束时间设为最大
  - 框选时按 ESC → 取消选择，恢复原范围
  - 框选时点击右键 → 取消选择，恢复原范围

### ▶️ 播放控制
- **播放模式**：
  - 鼠标在波形图上：从光标位置播放到文件结尾
  - 鼠标在波形图外：播放选中的剪辑范围
- **播放中点击**：点击波形图任意位置跳转到该处继续播放
- **播放控件**：暂停时可自由拖动进度条到任意位置
- **空格键**：播放/暂停切换

### 🎨 界面主题
- **三种主题**：浅色 / 深色 / 自适应（跟随系统）
- **主题切换按钮**：右上角 SVG 图标，点击循环切换
- **实时时间**：鼠标移动时显示浮动时间提示框
- **响应式设计**：适配不同屏幕尺寸

## 快速启动

### 方式一：使用启动脚本

```bash
cd /data/audio-editor
./start.sh        # 默认使用 8080 端口
./start.sh 3000   # 指定端口
```

### 方式二：手动启动

```bash
cd /data/audio-editor
python3 -m http.server 8080 --bind 0.0.0.0
```

## 访问地址

启动后浏览器访问：

- **本机访问**: http://localhost:8080
- **局域网访问**: http://你的IP:8080

同一局域网内的手机、电脑都可以通过局域网地址访问使用。

## 使用指南

### 基本流程
1. 打开页面，点击或拖拽上传音频文件
2. 通过以下方式选择剪辑范围：
   - 拖动波形图两侧的红色控制杆
   - 在波形图上按住鼠标左键框选
   - 点击"开始"/"结束"时间输入具体数值
3. 点击「▶ 播放选中范围」预览片段
4. 点击「📥 导出 MP3」下载剪辑后的文件

### 快捷键
| 按键 | 功能 |
|------|------|
| `Space` | 播放/暂停 |
| `ESC` | 取消当前框选（恢复原有范围） |
| `右键` | 框选时取消选择 |

### 主题切换
点击右上角的图标可在三种主题间切换：
- ☀️ 浅色模式
- 🌙 深色模式  
- 🌓 自适应模式（跟随系统设置）

## 代码关键逻辑

### 框选功能
```javascript
// mousedown: 记录起点，仅左键(button === 0)
// mousemove: 超过5px阈值后显示预览
// mouseup: 应用选择
// ESC/右键: 取消并恢复原范围
```

### 播放控制
```javascript
// 选择范围模式：播放到 endTime 停止
// 光标模式：播放到文件结尾
// 播放中点击波形图：跳转到点击位置
// 暂停时可自由拖动进度条
```

### 主题系统
```javascript
// CSS 变量控制颜色
// auto 模式监听 prefers-color-scheme
// light/dark 模式强制覆盖
```

## 浏览器支持

推荐使用以下现代浏览器：
- Chrome / Edge（推荐）
- Firefox
- Safari

## 注意事项

- 所有处理在浏览器本地完成，音频数据不会上传到服务器
- 大文件处理可能需要一些时间，请耐心等待
- 导出时会临时占用较多内存，建议处理单文件不超过 500MB
- 移动端使用时建议在 WiFi 环境下访问

## 许可证

MIT License
